pipeline {
  agent any
  stages {
    stage('Build-Test-Package') {
      agent {
        docker { image 'maven:3.9.6-eclipse-temurin-17' }
      }
              steps {
                git branch: 'main', url: 'https://github.com/Hydra2206/jenkins-by-me.git'
                
                dir('contentstack-java-news-web-app-example-master') {
                    sh '''
                      mvn -v
                      mvn clean compile
                      mvn test
                      mvn package -DskipTests
                    '''

                    archiveArtifacts artifacts: '/var/lib/jenkins/workspace/java-maven-first-pipeline@2/contentstack-java-news-web-app-example-master/target/*.jar'
                }
    }
    }
    stage('Deploy') {
            steps {
                sh '''
                   echo "Deploying application..."
                   
                   systemctl restart myapp
                '''
            }
        }
    }
  post {
    success {
        echo 'Pipeline completed successfully!'
    }
    failure {
        echo 'Pipeline failed!'
    }
}
}
